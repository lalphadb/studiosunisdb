<script setup lang="ts">
import { computed } from 'vue'
import { Link, router } from '@inertiajs/vue3'

interface Stats {
  total_membres: number
  membres_actifs: number
  total_cours: number
  presences_aujourd_hui: number
  revenus_mois: number
  evolution_revenus: number
  paiements_en_retard: number
}

const props = defineProps<{
  stats: Stats
}>()

const ceinturesData = computed(() => [
  { nom: 'Blanc', count: 85, couleur: '#F8FAFC' },
  { nom: 'Jaune', count: 72, couleur: '#FEF08A' },
  { nom: 'Orange', count: 45, couleur: '#FDBA74' },
  { nom: 'Vert', count: 28, couleur: '#86EFAC' },
  { nom: 'Bleu', count: 15, couleur: '#93C5FD' },
  { nom: 'Marron', count: 8, couleur: '#D2B48C' },
  { nom: 'Noir', count: 3, couleur: '#374151' }
])

const maxCeintures = computed(() => Math.max(...ceinturesData.value.map(c => c.count)))

const formatMoney = (amount: number) => new Intl.NumberFormat('fr-CA', { style: 'currency', currency: 'CAD', minimumFractionDigits: 0 }).format(amount)

const navigateTo = (routeName: string, params = {}) => router.visit(route(routeName, params))

const logout = () => router.post(route('logout'))
</script>

<template>
  <div class="min-h-screen bg-gradient-to-br from-gray-900 to-black text-gray-100">
    <!-- Header élégant -->
    <header class="bg-black/50 backdrop-blur-md shadow-lg">
      <div class="max-w-7xl mx-auto py-4 px-4 sm:px-6 lg:px-8 flex justify-between items-center">
        <h1 class="text-2xl font-bold text-red-500 flex items-center">
          <span class="mr-2 text-3xl">🥋</span> StudiosDB v5 Pro
        </h1>
        <div class="flex items-center space-x-4">
          <span class="text-gray-300">{{ $page.props.auth.user.name }}</span>
          <button @click="logout" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition-colors">
            Déconnexion
          </button>
        </div>
      </div>
    </header>

    <!-- Navigation moderne -->
    <nav class="bg-black/30 backdrop-blur-md">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex space-x-6 overflow-x-auto">
          <Link :href="route('dashboard')" class="flex items-center text-gray-300 hover:text-red-500 px-3 py-3 text-sm font-medium transition-colors">
            <span class="mr-2">🏠</span> Dashboard
          </Link>
          <button @click="navigateTo('membres.index')" class="flex items-center text-gray-300 hover:text-red-500 px-3 py-3 text-sm font-medium transition-colors">
            <span class="mr-2">👥</span> Membres
          </button>
          <button @click="navigateTo('presences.tablette')" class="flex items-center text-gray-300 hover:text-red-500 px-3 py-3 text-sm font-medium transition-colors">
            <span class="mr-2">✅</span> Présences
          </button>
          <button @click="navigateTo('cours.index')" class="flex items-center text-gray-300 hover:text-red-500 px-3 py-3 text-sm font-medium transition-colors">
            <span class="mr-2">📚</span> Cours
          </button>
          <button @click="navigateTo('paiements.index')" class="flex items-center text-gray-300 hover:text-red-500 px-3 py-3 text-sm font-medium transition-colors">
            <span class="mr-2">💰</span> Finances
          </button>
        </div>
      </div>
    </nav>

    <!-- Contenu principal -->
    <main class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8 space-y-8">
      
      <!-- Métriques principales - Cartes professionnelles -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        <div @click="navigateTo('membres.index')" class="bg-gray-800 rounded-xl shadow-lg overflow-hidden cursor-pointer hover:shadow-red-500/20 hover:scale-105 transition-all duration-300">
          <div class="p-6">
            <div class="flex items-center justify-between">
              <span class="text-4xl animate-pulse">👥</span>
              <span class="text-green-400 text-sm font-semibold">+{{ stats.evolution_revenus }}%</span>
            </div>
            <div class="mt-4">
              <div class="text-sm text-gray-400">Membres</div>
              <div class="text-3xl font-bold">{{ stats.total_membres }}</div>
              <div class="text-sm text-gray-500">{{ stats.membres_actifs }} actifs</div>
            </div>
          </div>
        </div>

        <!-- Carte Cours -->
        <div @click="navigateTo('cours.index')" class="bg-gray-800 rounded-xl shadow-lg overflow-hidden cursor-pointer hover:shadow-red-500/20 hover:scale-105 transition-all duration-300">
          <div class="p-6">
            <div class="flex items-center justify-between">
              <span class="text-4xl animate-pulse">📚</span>
              <span class="text-blue-400 text-sm font-semibold">Tous niveaux</span>
            </div>
            <div class="mt-4">
              <div class="text-sm text-gray-400">Cours actifs</div>
              <div class="text-3xl font-bold">{{ stats.total_cours }}</div>
              <div class="text-sm text-gray-500">Planning optimisé</div>
            </div>
          </div>
        </div>

        <!-- Carte Présences -->
        <div @click="navigateTo('presences.tablette')" class="bg-gray-800 rounded-xl shadow-lg overflow-hidden cursor-pointer hover:shadow-red-500/20 hover:scale-105 transition-all duration-300">
          <div class="p-6">
            <div class="flex items-center justify-between">
              <span class="text-4xl animate-pulse">✅</span>
              <span class="text-purple-400 text-sm font-semibold">Cette semaine</span>
            </div>
            <div class="mt-4">
              <div class="text-sm text-gray-400">Présences</div>
              <div class="text-3xl font-bold">{{ stats.presences_aujourd_hui }}</div>
              <div class="text-sm text-gray-500">Taux élevé</div>
            </div>
          </div>
        </div>

        <!-- Carte Revenus -->
        <div @click="navigateTo('paiements.index')" class="bg-gray-800 rounded-xl shadow-lg overflow-hidden cursor-pointer hover:shadow-red-500/20 hover:scale-105 transition-all duration-300">
          <div class="p-6">
            <div class="flex items-center justify-between">
              <span class="text-4xl animate-pulse">💰</span>
              <span class="text-yellow-400 text-sm font-semibold">+{{ stats.evolution_revenus }}%</span>
            </div>
            <div class="mt-4">
              <div class="text-sm text-gray-400">Revenus</div>
              <div class="text-3xl font-bold">{{ formatMoney(stats.revenus_mois) }}</div>
              <div class="text-sm text-gray-500">{{ stats.paiements_en_retard }} en retard</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Actions rapides - Boutons élégants -->
      <div class="bg-gray-800 rounded-xl shadow-lg p-6">
        <h3 class="text-lg font-semibold text-white mb-4">Actions rapides</h3>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
          <button @click="navigateTo('membres.create')" class="bg-blue-900/50 hover:bg-blue-900 text-white p-4 rounded-lg transition-all duration-300 hover:shadow-lg hover:scale-105">
            <div class="text-3xl mb-2">👤</div>
            <div class="font-medium">Nouveau Membre</div>
            <div class="text-sm opacity-75">Inscription rapide</div>
          </button>

          <button @click="navigateTo('presences.tablette')" class="bg-green-900/50 hover:bg-green-900 text-white p-4 rounded-lg transition-all duration-300 hover:shadow-lg hover:scale-105">
            <div class="text-3xl mb-2">📋</div>
            <div class="font-medium">Prendre Présences</div>
            <div class="text-sm opacity-75">Interface tablette</div>
          </button>

          <button @click="navigateTo('paiements.index')" class="bg-yellow-900/50 hover:bg-yellow-900 text-white p-4 rounded-lg transition-all duration-300 hover:shadow-lg hover:scale-105">
            <div class="text-3xl mb-2">💳</div>
            <div class="font-medium">Gérer Paiements</div>
            <div class="text-sm opacity-75">Factures et relances</div>
          </button>

          <button @click="navigateTo('cours.planning')" class="bg-purple-900/50 hover:bg-purple-900 text-white p-4 rounded-lg transition-all duration-300 hover:shadow-lg hover:scale-105">
            <div class="text-3xl mb-2">📅</div>
            <div class="font-medium">Planning Cours</div>
            <div class="text-sm opacity-75">Horaires et salles</div>
          </button>
        </div>
      </div>

      <!-- Progression ceintures - Barres interactives -->
      <div class="bg-gray-800 rounded-xl shadow-lg p-6">
        <h3 class="text-lg font-semibold text-white mb-4">Répartition par ceintures</h3>
        <div class="space-y-4">
          <div v-for="ceinture in ceinturesData" :key="ceinture.nom" class="flex items-center group">
            <div class="w-20 text-sm text-gray-400 group-hover:text-white transition-colors">{{ ceinture.nom }}</div>
            <div class="flex-1 mx-4">
              <div class="bg-gray-700 rounded-full h-3 overflow-hidden">
                <div 
                  class="h-3 rounded-full transition-all duration-500 group-hover:scale-105"
                  :style="{ 
                    width: `${(ceinture.count / maxCeintures) * 100}%`,
                    backgroundColor: ceinture.couleur 
                  }"
                ></div>
              </div>
            </div>
            <div class="w-16 text-right text-sm text-gray-400 group-hover:text-white transition-colors">{{ ceinture.count }}</div>
          </div>
        </div>
      </div>

    </main>
  </div>
</template>