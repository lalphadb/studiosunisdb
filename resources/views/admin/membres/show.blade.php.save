@extends('layouts.admin')

@section('title', 'Profil Membre')

@section('content')
<div class="space-y-6">
    {{-- Header Professionnel Clean --}}
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 p-6">
        <div class="flex items-center justify-between">
            <div class="flex items-center space-x-6">
                {{-- Avatar avec initiales --}}
                <div class="relative">
                    <div class="w-20 h-20 bg-gradient-to-br from-gray-600 to-gray-800 rounded-xl flex items-center justify-center text-white text-xl font-bold shadow-lg">
                        {{ strtoupper(substr($membre->prenom, 0, 1)) }}{{ strtoupper(substr($membre->nom, 0, 1)) }}
                    </div>
                    {{-- Statut indicator --}}
                    <div class="absolute -bottom-1 -right-1 w-6 h-6 {{ $membre->statut === 'actif' ? 'bg-green-500' : 'bg-red-500' }} rounded-full border-2 border-white shadow-md"></div>
                </div>
                
                <div>
                    <h1 class="text-3xl font-bold text-gray-900 dark:text-white">{{ $membre->prenom }} {{ $membre->nom }}</h1>
                    <div class="flex items-center space-x-4 mt-2">
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200">
                            <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"></path>
                            </svg>
                            {{ $membre->ecole->nom ?? 'École non assignée' }}
                        </span>
                        
                        {{-- Ceinture avec octogone coloré --}}
                        @php $ceintureActuelle = $membre->getCeintureActuellePourAffichage(); @endphp
                        @if($ceintureActuelle)
                        <div class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200">
                            {{-- Octogone coloré selon la ceinture --}}
                            <div class="w-5 h-5 mr-2 relative">
                                <svg viewBox="0 0 24 24" class="w-5 h-5" style="color: {{ $ceintureActuelle->couleur ?? '#fbbf24' }}">
                                    <path fill="currentColor" d="M8.6 1h6.8l5.7 5.7v6.8l-5.7 5.7H8.6L2.9 13.5V6.7L8.6 1z"/>
                                    <path fill="rgba(255,255,255,0.3)" d="M8.6 1h6.8l5.7 5.7v6.8l-5.7 5.7H8.6L2.9 13.5V6.7L8.6 1z"/>
                                </svg>
                            </div>
                            {{ $ceintureActuelle->nom }}
                        </div>
                        @endif
                    </div>
                </div>
            </div>
            
            {{-- Actions --}}
            <div class="flex space-x-3">
                <a href="{{ route('admin.membres.edit', $membre) }}" 
                   class="inline-flex items-center px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 dark:bg-gray-700 dark:text-gray-200 dark:border-gray-600 dark:hover:bg-gray-600">
                    <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"></path>
                    </svg>
                    Modifier
                </a>
                <a href="{{ route('admin.membres.index') }}" 
                   class="inline-flex items-center px-4 py-2 border border-transparent rounded-lg text-sm font-medium text-white bg-blue-600 hover:bg-blue-700">
                    ← Retour
                </a>
            </div>
        </div>
    </div>

    {{-- Layout Principal en Grid --}}
    <div class="grid grid-cols-12 gap-6">
        
        {{-- Informations Personnelles (8 colonnes) --}}
        <div class="col-span-12 lg:col-span-8">
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700">
                <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Informations Personnelles</h3>
                </div>
                <div class="p-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        {{-- Colonne Gauche --}}
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-500 dark:text-gray-400 mb-1">Email</label>
                                <p class="text-gray-900 dark:text-white font-medium">{{ $membre->email ?? 'Non renseigné' }}</p>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-500 dark:text-gray-400 mb-1">Téléphone</label>
                                <p class="text-gray-900 dark:text-white font-medium">{{ $membre->telephone ?? 'Non renseigné' }}</p>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-500 dark:text-gray-400 mb-1">Date de naissance</label>
                                <p class="text-gray-900 dark:text-white font-medium">
                                    @if($membre->date_naissance)
                                        {{ $membre->date_naissance->format('d/m/Y') }}
                                        <span class="text-sm text-gray-500 dark:text-gray-400 ml-2">({{ $membre->age }} ans)</span>
                                    @else
                                        Non renseigné
                                    @endif
                                </p>
                            </div>
                        </div>
                        
                        {{-- Colonne Droite --}}
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-500 dark:text-gray-400 mb-1">Date d'inscription</label>
                                <p class="text-gray-900 dark:text-white font-medium">
                                    {{ $membre->date_inscription->format('d/m/Y') }}
                                    <span class="text-sm text-gray-500 dark:text-gray-400 ml-2">({{ $membre->date_inscription->diffForHumans() }})</span>
                                </p>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-500 dark:text-gray-400 mb-1">Adresse</label>
                                <p class="text-gray-900 dark:text-white font-medium">{{ $membre->adresse ?? 'Non renseigné' }}</p>
                            </div>
                            
                            {{-- Contact d'urgence si présent --}}
                            @if($membre->contact_urgence)
                            <div class="bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4">
                                <label class="block text-sm font-medium text-red-700 dark:text-red-400 mb-1">Contact d'urgence</label>
                                <p class="text-red-900 dark:text-red-100 font-medium">{{ $membre->contact_urgence }}</p>
                                <p class="text-red-700 dark:text-red-300 text-sm">{{ $membre->telephone_urgence ?? 'Pas de téléphone' }}</p>
                            </div>
                            @endif
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        {{-- Sidebar Actions et Stats (4 colonnes) --}}
        <div class="col-span-12 lg:col-span-4 space-y-6">
            
            {{-- Actions Rapides --}}
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700">
                <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Actions Rapides</h3>
                </div>
                <div class="p-6 space-y-3">
                    <a href="{{ route('admin.ceintures.create', ['membre_id' => $membre->id]) }}" 
                       class="w-full inline-flex items-center justify-center px-4 py-3 border border-transparent rounded-lg text-sm font-medium text-white bg-orange-600 hover:bg-orange-700 transition-colors">
                        <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                        </svg>
                        Attribuer Ceinture
                    </a>
                    
                    <a href="{{ route('admin.seminaires.create', ['membre_id' => $membre->id]) }}" 
                       class="w-full inline-flex items-center justify-center px-4 py-3 border border-transparent rounded-lg text-sm font-medium text-white bg-purple-600 hover:bg-purple-700 transition-colors">
                        <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        Voir Séminaires
                    </a>
                    
                    <button class="w-full inline-flex items-center justify-center px-4 py-3 border border-gray-300 rounded-lg text-sm font-medium text-gray-500 bg-gray-100 cursor-not-allowed" disabled>
                        <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                        </svg>
                        Prendre Présence
                    </button>
                </div>
            </div>
            
            {{-- Statistiques --}}
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700">
                <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Statistiques</h3>
                </div>
                <div class="p-6">
                    <div class="grid grid-cols-1 gap-4">
                        <div class="text-center">
                            <div class="text-2xl font-bold text-blue-600 dark:text-blue-400">0</div>
                            <div class="text-sm text-gray-500 dark:text-gray-400">Cours actifs</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-green-600 dark:text-green-400">0</div>
                            <div class="text-sm text-gray-500 dark:text-gray-400">Présences ce mois</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-purple-600 dark:text-purple-400">N/A</div>
                            <div class="text-sm text-gray-500 dark:text-gray-400">Taux de présence</div>
                        </div>
                    </div>
                </div>
            </div>
            
            {{-- Informations Système --}}
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700">
                <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Informations</h3>
                </div>
                <div class="p-6 space-y-3 text-sm">
                    <div class="flex justify-between">
                        <span class="text-gray-500 dark:text-gray-400">ID Membre</span>
                        <span class="text-gray-900 dark:text-white font-mono">#{{ $membre->id }}</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-500 dark:text-gray-400">Créé le</span>
                        <span class="text-gray-900 dark:text-white">{{ $membre->created_at->format('d/m/Y') }}</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-500 dark:text-gray-400">Modifié le</span>
                        <span class="text-gray-900 dark:text-white">{{ $membre->updated_at->format('d/m/Y') }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    {{-- Section Progression Ceintures --}}
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700">
        <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
            <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Progression des Ceintures</h3>
        </div>
        <div class="p-6">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                
                {{-- Ceinture Actuelle --}}
                <div class="space-y-4">
                    <h4 class="text-base font-semibold text-gray-900 dark:text-white">Ceinture Actuelle</h4>
                    
                    @if($ceintureActuelle)
                        <div class="flex items-center p-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg">
                            {{-- Octogone avec couleur de ceinture --}}
                            <div class="flex-shrink-0 mr-4">
                                <svg viewBox="0 0 48 48" class="w-12 h-12" style="color: {{ $ceintureActuelle->couleur ?? '#fbbf24' }}">
                                    <path fill="currentColor" d="M17.2 2h13.6l11.4 11.4v13.6l-11.4 11.4H17.2L5.8 27V13.4L17.2 2z"/>
                                    <path fill="rgba(255,255,255,0.4)" d="M17.2 2h13.6l11.4 11.4v13.6l-11.4 11.4H17.2L5.8 27V13.4L17.2 2z"/>
                                    <circle cx="24" cy="24" r="8" fill="rgba(255,255,255,0.2)"/>
                                </svg>
                            </div>
                            <div class="flex-1">
                                <div class="text-lg font-semibold text-gray-900 dark:text-white">{{ $ceintureActuelle->nom }}</div>
                                <div class="text-sm text-gray-600 dark:text-gray-400">Niveau {{ $ceintureActuelle->niveau }}</div>
                                @if($membre->derniereCeinture)
                                    <div class="text-sm text-gray-500 dark:text-gray-400">
                                        Obtenue le {{ $membre->derniereCeinture->date_obtention->format('d/m/Y') }}
                                    </div>
                                @endif
                            </div>
                        </div>
                    @else
                        <div class="text-center py-8 text-gray-500 dark:text-gray-400">
                            <svg class="w-12 h-12 mx-auto mb-4 opacity-50" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                            </svg>
                            <p>Aucune ceinture attribuée</p>
                        </div>
                    @endif
                </div>

                {{-- Prochaine Ceinture --}}
                <div class="space-y-4">
                    <h4 class="text-base font-semibold text-gray-900 dark:text-white">Prochaine Ceinture</h4>
                    
                    @if($ceintureActuelle && $ceintureActuelle->prochaineCeinture())
                        @php $prochaine = $ceintureActuelle->prochaineCeinture(); @endphp
                        <div class="flex items-center p-4 bg-gray-50 dark:bg-gray-700/50 border border-gray-200 dark:border-gray-600 rounded-lg border-dashed">
                            {{-- Octogone en attente --}}
                            <div class="flex-shrink-0 mr-4">
                                <svg viewBox="0 0 48 48" class="w-12 h-12 opacity-60" style="color: {{ $prochaine->couleur ?? '#6b7280' }}">
                                    <path fill="currentColor" d="M17.2 2h13.6l11.4 11.4v13.6l-11.4 11.4H17.2L5.8 27V13.4L17.2 2z"/>
                                    <path fill="rgba(255,255,255,0.3)" d="M17.2 2h13.6l11.4 11.4v13.6l-11.4 11.4H17.2L5.8 27V13.4L17.2 2z"/>
                                    <circle cx="24" cy="24" r="8" fill="rgba(255,255,255,0.1)"/>
                                </svg>
                            </div>
                            <div class="flex-1">
                                <div class="text-lg font-semibold text-gray-700 dark:text-gray-300">{{ $prochaine->nom }}</div>
                                <div class="text-sm text-gray-500 dark:text-gray-400">Niveau {{ $prochaine->niveau }}</div>
                                <div class="text-xs text-blue-600 dark:text-blue-400 mt-1">Objectif suivant</div>
                            </div>
                        </div>
                    @else
                        <div class="text-center py-8 text-gray-500 dark:text-gray-400">
                            <svg class="w-12 h-12 mx-auto mb-4 text-green-500" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                            </svg>
                            <p class="font-medium text-green-600 dark:text-green-400">Niveau Maximum Atteint !</p>
                            <p class="text-sm">Félicitations pour votre parcours</p>
                        </div>
                    @endif
                </div>
            </div>

            {{-- Barre de progression --}}
            @if($ceintureActuelle)
            <div class="mt-8">
                <div class="flex justify-between items-center mb-3">
                    <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Progression</span>
                    <span class="text-sm text-gray-500 dark:text-gray-400">{{ $ceintureActuelle->niveau }}/10</span>
                </div>
                <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3">
                    <div class="bg-gradient-to-r from-yellow-400 to-orange-500 h-3 rounded-full transition-all duration-500"
                         style="width: {{ ($ceintureActuelle->niveau / 10) * 100 }}%"></div>
                </div>
            </div>
            @endif
        </div>
    </div>

    {{-- Notes si présentes --}}
    @if($membre->notes)
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700">
        <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
            <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Notes Internes</h3>
        </div>
        <div class="p-6">
            <p class="text-gray-700 dark:text-gray-300 leading-relaxed">{{ $membre->notes }}</p>
        </div>
    </div>
    @endif
</div>

<style>
/* CSS personnalisé pour les octogones colorés */
.octagon {
    clip-path: polygon(30% 0%, 70% 0%, 100% 30%, 100% 70%, 70% 100%, 30% 100%, 0% 70%, 0% 30%);
}

/* Couleurs spécifiques pour les ceintures */
.belt-blanc { color: #ffffff; background: #f3f4f6; }
.belt-jaune { color: #fbbf24; }
.belt-orange { color: #f97316; }
.belt-vert { color: #10b981; }
.belt-bleu { color: #3b82f6; }
.belt-marron { color: #92400e; }
.belt-noir { color: #1f2937; }
</style>
@endsection
